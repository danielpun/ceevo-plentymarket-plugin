<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv='cache-control' content='no-cache'>
  <meta http-equiv='expires' content='0'>
  <meta http-equiv='pragma' content='no-cache'>

  <title>Payment Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">

  <script src="https://sdk-beta.ceevo.com/ceevo.js"></script>
  <!-- <script src="https://sdk.ceevo.com/ceevo.js"></script> -->
  <!-- <script src="http://localhost:8080/app.js"></script> -->
  <style type="text/css">
    .control-group {
      margin-bottom: 15px;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="row clearfix">
      <!-- Building Form. -->
      <div class="span10 offset1">
        <div class="clearfix">
          <h2>Payment Demo</h2>
          <div id="errorDiv"></div>
          <hr>
          <form id="checkout_form" action="ceevo_widget_backend.php" method="POST">
            <input type="hidden" id="token_hidden_input" name="token_hidden_input">
            <input type="hidden" id="session_hidden_input" name="session_hidden_input">
            <input type="hidden" id="3dsecure" name="3dsecure" value="false">
            <div class="control-group">
              <label class="control-label" for="">Price</label>
              <div class="controls">
                <input id="price" name="price" type="text" placeholder="" class="input-xlarge" value="1234">
              </div>
            </div>
            <div class="control-group">
              <label class="control-label" for="">Currency</label>
              <div class="controls">
                <input id="currency" name="currency" type="text" placeholder="" class="input-xlarge" value="EUR">
              </div>
            </div>
            <div class="control-group">
              <label class="control-label" for="">Reference Id</label>
              <div class="controls">
                <input id="referenceId" name="referenceId" type="text" placeholder="" class="input-xlarge"
                  value="dantest123">
              </div>
            </div>
            <div class="control-group">
              <label class="control-label" for="">Email</label>
              <div class="controls">
                <input id="userEmail" name="userEmail" type="text" placeholder="" class="input-xlarge"
                  value="daniel@transact24.com">
              </div>
            </div>
            <div class="control-group">
              <label class="control-label" for="">City</label>
              <div class="controls">
                <input id="city" name="city" type="text" placeholder="" class="input-xlarge" value="zhuhai">
              </div>
            </div>
            <div class="control-group">
              <label class="control-label" for="">Country</label>
              <div class="controls">
                <input id="country" name="country" type="text" placeholder="" class="input-xlarge" value="CN">
              </div>
            </div>
            <div class="control-group">
              <label class="control-label" for="">State</label>
              <div class="controls">
                <input id="state" name="state" type="text" placeholder="" class="input-xlarge" value="GD">
              </div>
            </div>
            <div class="control-group">
              <label class="control-label" for="">Street</label>
              <div class="controls">
                <input id="street" name="street" type="text" placeholder="" class="input-xlarge" value="one way street">
              </div>
            </div>
            <div class="control-group">
              <label class="control-label" for="">Zip</label>
              <div class="controls">
                <input id="zip" name="zip" type="text" placeholder="" class="input-xlarge" value="123456">
              </div>
            </div>
          </form>
          <div class="control-group">
            <label class="control-label" for=""></label>
            <div class="controls">
              <button id="" name="" type="button" class="btn btn-primary" onclick="submitPayment();">Submit</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- / Building Form. -->

  </div>

  <div>
    <p>result:</p>
    <div id="resultDiv"></div>
  </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/jquery@1.9.1/jquery.min.js"></script>
<script type="text/javascript" language="JavaScript">

  // var apikey = '3af64008-b479-404d-b2ae-6f6acfe5e06e';
  var apikey = '5f597ddd-4e9b-45f4-b7e4-9ed65373e48b';
  var formId = 'form#checkout_form';
  var config = {
    envMode: 'TEST', // LIVE
    receiveTokensEvent: false // support custom event listener 'receiveTokens' to send tokenise data to merchant. default false.
  };

  var ceevoPayment = new CeevoPayment(apikey, formId, config);

  function submitPayment() {
    var widget = ceevoPayment.widget();
    // widget.setPrice($('#price').val());
    // widget.setCurrency($('#currency').val());
    // widget.open();

    // old
    ceevoPayment.setPrice($('#price').val());
    ceevoPayment.setCurrency($('#currency').val());
    ceevoPayment.open_widget();
  }

  ceevoPayment.addErrorCallBack(function (error) {
    document.getElementById('errorDiv').innerHTML = '';
    document.getElementById('errorDiv').innerHTML = error;
    document.getElementById('resultDiv').innerHTML = '';
  });

  /**
  * for receiveTokensEvent is true only
  */
  // listen custom event when receiveTokensEvent is true
  document.getElementById('checkout_form').addEventListener('receiveTokens', function ({ detail }) {
    console.log('form.eventListener', detail);
    var result = '';
    for (var key in detail) {
      result += key + ': ' + detail[key] + '<br/>';
    }
    document.getElementById('resultDiv').innerHTML = result;
  })

  /**
  * for receiveTokensEvent is true only
  */
  // listen custom event when receiveTokensEvent is true, base on window
  window.addEventListener('receiveTokens', function ({ detail }) {
    console.log('window.eventListener', detail);
  })
</script>

</html>